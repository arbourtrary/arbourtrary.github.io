<script>
  import Footer from "./Footer.svelte";
  import { onMount } from 'svelte';
  import { base } from '$app/paths'

  let isOpen = false;
  let overlay;
  let mounted = false;

  onMount(() => {
    mounted = true;
  });
  
  function toggleMenu() {
    isOpen = !isOpen;
    if (isOpen) {
      mounted && document.body.classList.add("no-overflow");
      overlay && overlay.classList.add("fade");
    } else {
      mounted && document.body.classList.remove("no-overflow");
      overlay && overlay.classList.remove("fade");
    }
  }

  $: !isOpen && mounted && document.body.classList.remove("no-overflow");
</script>

<div class="overlay" bind:this={overlay}></div>

<div class="menu-container">
  <!-- Menu Button -->
  <button 
    class="menu-button" 
    on:click={toggleMenu}
    aria-label={isOpen ? 'Close menu' : 'Open menu'}
  >
    {#if isOpen}
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
        <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
      </svg>
    {:else}
      <svg width="20px" height="20px" version="1.1" viewBox="0 0 155.48 172.74" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"><g transform="translate(-.71757 -.67337)"><image x="20.782" y="40.479" width="157.01" height="175.23" display="none" image-rendering="auto" preserveAspectRatio="none"/><path d="m84.498 166.39c-5.0193-1.4215-9.9229-3.3434-14.569-5.7149-4.6237-2.3599-8.8691-5.4117-13.111-8.4043-3.5897-2.5326-7.4968-4.7899-10.421-8.0682-2.8785-3.2267-3.9746-7.7559-6.7235-11.094-2.118-2.5719-4.9466-4.4648-7.3958-6.7235-3.4969-3.2248-7.0748-6.3684-10.421-9.749-3.85-3.8892-8.45-7.3107-11.094-12.102-3.0843-5.5902-5.1086-12.094-5.0426-18.478 0.05317-5.1445 2.6657-9.9486 4.3703-14.803 1.765-5.0263 3.6179-10.053 6.0511-14.792 3.0816-6.0019 6.4733-11.933 10.758-17.145 3.3224-4.0417 7.4324-7.382 11.43-10.758 4.4007-3.7161 8.8894-7.3837 13.783-10.421 5.1094-3.1715 10.515-5.9318 16.136-8.0682 5.2433-1.9927 10.651-4.0364 16.25-4.3703 3.1263-0.1864 6.2514 0.62252 9.2989 1.3447 4.1377 0.98053 8.232 2.2725 12.102 4.0341 6.6294 3.0174 13.189 6.4801 18.826 11.094 4.5439 3.7194 8.2034 8.4429 11.766 13.111 3.6397 4.7687 7.0936 9.7485 9.749 15.128 2.0554 4.1636 4.1492 8.501 4.7064 13.111 0.90637 7.4979-0.88123 15.127-2.3532 22.535-1.3828 6.959-4.0873 13.589-6.0511 20.407-2.6493 9.1978-4.8489 18.528-7.732 27.655-1.8255 5.779-3.6097 11.598-6.0511 17.145-1.5348 3.4871-2.5657 7.5157-5.3788 10.085-4.0415 3.6915-9.8151 5.0696-15.128 6.3873-2.511 0.6228-5.145 0.68494-7.732 0.67235-3.49-0.017-6.9642-0.5308-10.421-1.0085-1.8792-0.25967-3.7758-0.4916-5.601-1.0085z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="10" style="paint-order:normal"/><path d="m84.413 137.38c-3.3586-0.95118-6.6397-2.2372-9.7489-3.824-3.0938-1.5791-5.9346-3.6212-8.7728-5.6236-2.402-1.6947-5.0164-3.2051-6.9733-5.3987-1.9261-2.1591-2.6596-5.1897-4.4989-7.4232-1.4172-1.7209-3.3099-2.9875-4.9488-4.4989-2.3399-2.1578-4.734-4.2613-6.9733-6.5234-2.5762-2.6024-5.6542-4.8918-7.4232-8.098-2.0638-3.7406-3.4183-8.0925-3.3742-12.364 0.03558-3.4424 1.7837-6.6569 2.9243-9.905 1.181-3.3632 2.4209-6.7265 4.049-9.8976 2.062-4.0161 4.3315-7.9847 7.1982-11.472 2.2231-2.7045 4.9733-4.9395 7.6481-7.1982 2.9447-2.4865 5.9482-4.9407 9.2227-6.9733 3.4188-2.1222 7.0359-3.9692 10.797-5.3987 3.5085-1.3334 7.1269-2.7009 10.874-2.9243 2.0919-0.12473 4.183 0.41655 6.2222 0.89978 2.7687 0.6561 5.5083 1.5206 8.098 2.6993 4.4359 2.019 8.8255 4.3361 12.597 7.4232 3.0405 2.4888 5.4891 5.6495 7.8731 8.7728 2.4354 3.1909 4.7465 6.523 6.5234 10.122 1.3753 2.786 2.7764 5.6883 3.1492 8.7728 0.60648 5.0171-0.58965 10.122-1.5746 15.079-0.9253 4.6565-2.735 9.0928-4.049 13.655-1.7728 6.1545-3.2446 12.397-5.1737 18.505-1.2215 3.8669-2.4154 7.7605-4.049 11.472-1.027 2.3334-1.7168 5.029-3.5991 6.7483-2.7043 2.4701-6.5676 3.3922-10.122 4.2739-1.6802 0.41676-3.4427 0.45833-5.1737 0.4499-2.3353-0.0114-4.66-0.35518-6.9733-0.67484-1.2574-0.17376-2.5265-0.32894-3.7478-0.67484z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="10" style="paint-order:normal"/><path d="m84.742 113.17c-1.8779-0.5457-3.7126-1.2835-5.451-2.1939-1.7299-0.90598-3.3183-2.0776-4.9053-3.2264-1.3431-0.97227-2.8049-1.8388-3.8991-3.0974-1.077-1.2387-1.4871-2.9775-2.5155-4.2589-0.79243-0.98734-1.8507-1.714-2.7671-2.5811-1.3083-1.238-2.647-2.4448-3.8991-3.7427-1.4404-1.4931-3.1615-2.8066-4.1506-4.6461-1.154-2.1461-1.9113-4.6429-1.8867-7.0938 0.0199-1.975 0.99735-3.8193 1.6351-5.6828 0.66035-1.9296 1.3536-3.8592 2.264-5.6785 1.153-2.3041 2.4219-4.5811 4.0249-6.5819 1.2431-1.5516 2.7808-2.834 4.2764-4.1298 1.6465-1.4266 3.3259-2.8346 5.1569-4.0008 1.9116-1.2175 3.9341-2.2772 6.0373-3.0974 1.9618-0.765 3.985-1.5496 6.0799-1.6777 1.1697-0.07155 2.3389 0.23899 3.4791 0.51623 1.5481 0.37642 3.0799 0.87243 4.528 1.5487 2.4803 1.1584 4.9347 2.4877 7.0435 4.2589 1.7001 1.4279 3.0692 3.2412 4.4022 5.0332 1.3617 1.8307 2.654 3.7425 3.6475 5.8076 0.76901 1.5984 1.5524 3.2635 1.7609 5.0332 0.33911 2.8784-0.3297 5.8073-0.88043 8.6511-0.51737 2.6715-1.5293 5.2168-2.264 7.8342-0.99124 3.531-1.8142 7.1127-2.8929 10.617-0.68297 2.2186-1.3505 4.4524-2.264 6.5819-0.57423 1.3387-0.95992 2.8853-2.0124 3.8717-1.5121 1.4172-3.6722 1.9462-5.66 2.4521-0.93945 0.2391-1.9249 0.26295-2.8929 0.25811-1.3057-6e-3 -2.6056-0.20377-3.8991-0.38717-0.70308-0.0997-1.4127-0.18871-2.0956-0.38719z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="10" style="paint-order:normal"/><path d="m84.649 90.698c-0.44948-0.12982-0.8886-0.30537-1.3047-0.52198-0.41405-0.21557-0.79423-0.49432-1.1741-0.76767-0.32146-0.23133-0.67135-0.43751-0.93324-0.73695-0.25777-0.29471-0.35593-0.70841-0.60209-1.0133-0.18967-0.23491-0.44297-0.40782-0.6623-0.61412-0.31314-0.29457-0.63355-0.5817-0.93323-0.89049-0.34477-0.35523-0.7567-0.66776-0.99344-1.1054-0.27621-0.51062-0.45748-1.1047-0.45157-1.6878 5e-3 -0.4699 0.23871-0.9087 0.39136-1.3521 0.15805-0.4591 0.32398-0.91822 0.54188-1.3511 0.27595-0.5482 0.57968-1.09 0.96334-1.566 0.29751-0.36917 0.66556-0.67428 1.0235-0.9826 0.39409-0.33942 0.79605-0.67443 1.2343-0.95189 0.45755-0.28969 0.94162-0.54181 1.445-0.73695 0.46954-0.18201 0.9538-0.36868 1.4552-0.39918 0.27996-0.0169 0.55981 0.0568 0.83272 0.12282 0.37052 0.0896 0.73716 0.20758 1.0838 0.36848 0.59366 0.27561 1.1811 0.5919 1.6858 1.0133 0.40691 0.33974 0.73462 0.77118 1.0537 1.1975 0.32594 0.43557 0.63523 0.89043 0.87301 1.3818 0.18407 0.3803 0.37157 0.77648 0.42147 1.1975 0.0811 0.68485-0.0789 1.3817-0.21073 2.0583-0.12382 0.63564-0.36603 1.2412-0.54188 1.864-0.23725 0.84015-0.43421 1.6923-0.6924 2.526-0.16348 0.52785-0.32325 1.0594-0.54188 1.566-0.13743 0.3185-0.22976 0.68649-0.48167 0.92119-0.36191 0.33717-0.87895 0.46306-1.3547 0.58341-0.22484 0.0569-0.46072 0.0626-0.69239 0.0614-0.31253-2e-3 -0.62365-0.0484-0.93323-0.0921-0.16829-0.0237-0.33814-0.0449-0.50158-0.0921z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="10" style="paint-order:normal"/></g></svg>
    {/if}
  </button>

  <!-- Side Menu Panel -->
  <nav class="side-menu" class:open={isOpen}>
    <ul>
      <li><a href={base + "/"}>Home</a></li>
      <li><a href={base + "/about"}>About</a></li>
      <li><a href={base + "/books"}>Books</a></li>
      <li><a href={base + "/music"}>Music</a></li>
      <li><a href={base + "/photos"}>Photos</a></li>
      <li><a href={base + "/poems"}>Poems</a></li>
      <li><a href={base + "/projects"}>Projects</a></li>
      <li><a href={base + "/sketches"}>Sketches</a></li>
      <li><a href={base + "/writings"}>Writings</a></li>
    </ul>
    
    <Footer/>
  </nav>
</div>

<style>
  .overlay {
    position: fixed;
    height: 100%;
    width: 100%;
    background: var(--bg-color);
    opacity: 0;
    pointer-events: none;
    margin: 0;
    padding: 0;
    top: 0;
    transition: opacity 0.8s ease-out;
  }
  :global(.overlay.fade) {
    opacity: 0.6 !important;
    pointer-events: all;
  }
  :global(nav footer) {
    padding-top: 30px !important;
  }
  nav {
    box-sizing: border-box;
    border-left: 0.5px solid var(--color-2);
  }
  .menu-container {
    position: relative;
    display: flex;
    width: 29px;
    padding: 0px;
    padding-right: 5px;
  }

  .menu-button {
    position: relative;
    z-index: 50;
    background: none;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .side-menu {
    position: fixed;
    top: 0;
    right: max(-250px, -100%);
    height: 100%;
    width: min(250px, 100%);;
    background: var(--bg-color);
    padding: 4rem 1.5rem;
    z-index: 45;
    transition: right .8s cubic-bezier(.16,1,.3,1);
  }

  .side-menu.open {
    right: 0;
  }

  ul {
    list-style: none;
    padding: 0;
    margin: 0 0 2rem 0;
  }

  li {
    margin-bottom: 1rem;
  }

  a {
    color: var(--color-1);
    font-family: var(--serif);
    font-size: var(--font-lg);
    text-decoration: none;
    text-decoration-color: var(--color-2);
    text-decoration-thickness: 0.5px;
    text-underline-offset: 3px;
    transition: color 0.2s ease;
    width: 100%;
    display: block;
  }

  a:hover {
    text-decoration: underline;
    text-decoration-color: var(--color-1);
    text-decoration-thickness: 1px;
  }

  .menu-button svg, .menu-button path {
    color: var(--color-1);
  }

  @media only screen and (max-width: 640px) {
    :global(nav footer) {
        margin: unset !important;
    }
  }
</style>